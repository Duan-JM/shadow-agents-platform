# 阶段七：创建中文文档和部署指南

## 目标
编写完整的中文文档体系，包括项目说明、部署指南、开发指南、API 文档等，确保用户和开发者能够轻松使用和二次开发。

---

## 总体思路

### 文档结构
```
docs/
├── README.md                    # 文档首页
├── architecture/                # 架构文档
│   ├── overview.md             # 架构概览
│   ├── backend.md              # 后端架构
│   ├── frontend.md             # 前端架构
│   └── database.md             # 数据库设计
├── guides/                      # 使用指南
│   ├── quick-start.md          # 快速开始
│   ├── deployment.md           # 部署指南（已完成）
│   ├── development.md          # 开发指南
│   ├── branding.md             # 品牌定制（已完成）
│   └── troubleshooting.md      # 故障排查
├── api-reference/               # API 文档
│   ├── authentication.md       # 认证接口
│   ├── apps.md                 # 应用接口
│   ├── workflows.md            # 工作流接口
│   └── datasets.md             # 数据集接口
└── contributing/                # 贡献指南
    ├── code-style.md           # 代码规范
    ├── git-workflow.md         # Git 工作流
    └── pull-request.md         # PR 规范
```

---

## 详细执行步骤

### 步骤 1：文档首页

**`docs/README.md`**
```markdown
# Shadow Agents Platform 文档

欢迎使用 Shadow Agents Platform！

---

## 📚 文档导航

### 快速开始
- [快速开始指南](guides/quick-start.md) - 5 分钟快速上手
- [部署指南](guides/deployment.md) - 完整部署说明
- [开发指南](guides/development.md) - 本地开发环境搭建

### 架构设计
- [架构概览](architecture/overview.md) - 系统整体架构
- [后端架构](architecture/backend.md) - 后端技术架构
- [前端架构](architecture/frontend.md) - 前端技术架构
- [数据库设计](architecture/database.md) - 数据模型设计

### API 文档
- [认证接口](api-reference/authentication.md) - 用户认证和授权
- [应用接口](api-reference/apps.md) - 应用管理
- [工作流接口](api-reference/workflows.md) - 工作流操作
- [数据集接口](api-reference/datasets.md) - 知识库管理

### 高级主题
- [品牌定制](guides/branding.md) - 自定义品牌元素
- [故障排查](guides/troubleshooting.md) - 常见问题解决
- [性能优化](guides/performance.md) - 性能调优指南
- [安全最佳实践](guides/security.md) - 安全配置建议

### 贡献指南
- [代码规范](contributing/code-style.md) - 编码标准
- [Git 工作流](contributing/git-workflow.md) - 版本控制流程
- [提交 PR](contributing/pull-request.md) - Pull Request 规范

---

## 🆘 获取帮助

- **问题反馈**: [GitHub Issues](https://github.com/your-org/shadow-agents-platform/issues)
- **功能建议**: [GitHub Discussions](https://github.com/your-org/shadow-agents-platform/discussions)
- **社区支持**: [Discord 频道](#)
- **商业支持**: support@your-domain.com

---

## 📖 推荐阅读顺序

### 新用户
1. [快速开始](guides/quick-start.md)
2. [架构概览](architecture/overview.md)
3. [部署指南](guides/deployment.md)

### 开发者
1. [开发指南](guides/development.md)
2. [后端架构](architecture/backend.md)
3. [前端架构](architecture/frontend.md)
4. [API 文档](api-reference/)

### 运维人员
1. [部署指南](guides/deployment.md)
2. [故障排查](guides/troubleshooting.md)
3. [性能优化](guides/performance.md)
4. [安全最佳实践](guides/security.md)

---

## 🔄 文档更新

本文档随项目持续更新。最后更新时间：2025-01-01

如发现文档错误或需要补充，欢迎提交 PR 或 Issue。

---
```

---

### 步骤 2：快速开始指南

**`docs/guides/quick-start.md`**
````markdown
# 快速开始

本指南将帮助您在 5 分钟内快速部署并使用 Shadow Agents Platform。

---

## 前提条件

- 安装 Docker 20.10+
- 安装 Docker Compose 2.0+
- 至少 4GB RAM
- 至少 20GB 磁盘空间

---

## 第一步：克隆项目

```bash
git clone https://github.com/your-org/shadow-agents-platform.git
cd shadow-agents-platform
```

---

## 第二步：配置环境

```bash
cd docker
cp .env.example .env
```

**重要**：编辑 `.env` 文件，修改以下配置：

```env
# 修改密钥（必须！）
SECRET_KEY=你的随机密钥

# 修改数据库密码
DB_PASSWORD=你的数据库密码

# 修改 Redis 密码
REDIS_PASSWORD=你的Redis密码
```

💡 **提示**：可以使用以下命令生成随机密钥：
```bash
openssl rand -hex 32
```

---

## 第三步：启动服务

```bash
./start.sh
```

等待所有服务启动完成（约 1-2 分钟）。

---

## 第四步：访问应用

打开浏览器访问：http://localhost

首次访问会进入安装向导：

1. **欢迎页面** - 点击"开始安装"
2. **管理员账户** - 填写邮箱、用户名和密码
3. **完成安装** - 自动跳转到登录页面

---

## 第五步：创建第一个应用

登录后：

1. 点击"创建应用"按钮
2. 选择应用类型（建议先选"聊天助手"）
3. 填写应用名称和描述
4. 点击"创建"

恭喜！您已成功创建第一个 AI 应用 🎉

---

## 下一步

- [了解应用类型](./app-types.md)
- [配置 AI 模型](./model-configuration.md)
- [创建知识库](./knowledge-base.md)
- [设计工作流](./workflow-design.md)

---

## 常见问题

### 端口被占用怎么办？

编辑 `docker/.env` 文件，修改端口配置：

```env
NGINX_PORT=8080  # 修改为其他端口
```

### 服务启动失败？

查看日志：
```bash
docker-compose logs
```

### 忘记管理员密码？

重置密码：
```bash
docker exec -it shadow-api flask reset-password admin@example.com
```

---

## 获取帮助

遇到问题？查看 [故障排查指南](troubleshooting.md) 或 [提交 Issue](https://github.com/your-org/shadow-agents-platform/issues)。

---
````

---

### 步骤 3：开发指南

**`docs/guides/development.md`**
````markdown
# 开发指南

本指南介绍如何在本地搭建开发环境，进行二次开发。

---

## 开发环境要求

### 后端开发
- Python 3.11+
- PostgreSQL 15+
- Redis 7+
- virtualenv 或 conda

### 前端开发
- Node.js 18+
- npm 或 pnpm

### 工具
- Git
- VS Code（推荐）
- Docker（可选，用于本地数据库）

---

## 后端开发

### 1. 克隆项目

```bash
git clone https://github.com/your-org/shadow-agents-platform.git
cd shadow-agents-platform/api
```

### 2. 创建虚拟环境

```bash
# 使用 venv
python3 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 或使用 conda
conda create -n shadow-agents python=3.11
conda activate shadow-agents
```

### 3. 安装依赖

```bash
pip install -e .
```

### 4. 配置环境变量

```bash
cp .env.example .env
```

编辑 `.env` 文件，配置数据库和 Redis 连接。

### 5. 启动数据库（使用 Docker）

```bash
# 只启动数据库和 Redis
cd ../docker
docker-compose up -d postgres redis
```

### 6. 初始化数据库

```bash
# 运行数据库迁移
flask db upgrade

# 创建测试用户
flask create-admin admin@example.com password123
```

### 7. 启动开发服务器

```bash
flask run --debug
```

API 服务将在 http://localhost:5001 启动。

---

## 前端开发

### 1. 进入前端目录

```bash
cd web
```

### 2. 安装依赖

```bash
npm install
# 或使用 pnpm
pnpm install
```

### 3. 配置环境变量

```bash
cp .env.example .env.local
```

编辑 `.env.local`：

```env
NEXT_PUBLIC_API_URL=http://localhost:5001
```

### 4. 启动开发服务器

```bash
npm run dev
```

Web 应用将在 http://localhost:3000 启动。

---

## 项目结构

### 后端结构

```
api/
├── app.py                   # 应用入口
├── configs/                 # 配置模块
├── controllers/             # 控制器（路由）
├── core/                    # 核心业务逻辑
├── models/                  # 数据模型
├── services/                # 服务层
├── libs/                    # 工具库
└── tests/                   # 测试代码
```

### 前端结构

```
web/
├── app/                     # Next.js 页面
├── components/              # React 组件
├── service/                 # API 服务
├── utils/                   # 工具函数
└── config/                  # 配置文件
```

---

## 代码规范

### Python 代码规范

遵循 PEP 8 规范：

```python
# 好的示例
def create_app(name: str, mode: str) -> App:
    """
    创建应用
    
    Args:
        name: 应用名称
        mode: 应用类型
        
    Returns:
        App: 应用对象
    """
    app = App(name=name, mode=mode)
    return app
```

使用类型注解和文档字符串。

### TypeScript 代码规范

```typescript
// 好的示例
interface CreateAppParams {
  name: string
  mode: 'chat' | 'completion' | 'agent' | 'workflow'
  description?: string
}

async function createApp(params: CreateAppParams): Promise<App> {
  // 实现...
}
```

使用 TypeScript 类型系统。

---

## 测试

### 后端测试

```bash
# 运行所有测试
pytest

# 运行特定测试
pytest tests/test_auth.py

# 生成覆盖率报告
pytest --cov=. --cov-report=html
```

### 前端测试

```bash
# 运行测试
npm test

# 运行 E2E 测试
npm run test:e2e
```

---

## 调试

### 后端调试

VS Code 配置 `.vscode/launch.json`：

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Python: Flask",
      "type": "python",
      "request": "launch",
      "module": "flask",
      "env": {
        "FLASK_APP": "app.py",
        "FLASK_DEBUG": "1"
      },
      "args": ["run", "--no-debugger"],
      "jinja": true
    }
  ]
}
```

### 前端调试

使用 Chrome DevTools 或 VS Code 调试器。

---

## Git 工作流

### 分支策略

- `main` - 主分支，生产代码
- `develop` - 开发分支
- `feature/*` - 功能分支
- `bugfix/*` - 修复分支

### 提交规范

使用语义化提交信息：

```
feat: 添加用户注册功能
fix: 修复登录页面样式问题
docs: 更新部署文档
refactor: 重构应用服务层
test: 添加认证服务测试
```

---

## 常用命令

### 后端

```bash
# 运行开发服务器
flask run --debug

# 数据库迁移
flask db migrate -m "描述"
flask db upgrade

# 创建管理员
flask create-admin email password

# 运行测试
pytest
```

### 前端

```bash
# 开发服务器
npm run dev

# 构建生产版本
npm run build

# 启动生产服务器
npm run start

# 代码检查
npm run lint
```

---

## 最佳实践

### 1. 代码组织
- 保持模块职责单一
- 使用合理的目录结构
- 避免循环依赖

### 2. 错误处理
- 使用自定义异常类
- 提供清晰的错误信息
- 记录详细的日志

### 3. 性能优化
- 使用数据库索引
- 实现缓存机制
- 优化 SQL 查询

### 4. 安全考虑
- 验证所有输入
- 使用参数化查询
- 实施权限控制

---

## 参考资源

- [Flask 文档](https://flask.palletsprojects.com/)
- [Next.js 文档](https://nextjs.org/docs)
- [SQLAlchemy 文档](https://docs.sqlalchemy.org/)
- [React 文档](https://react.dev/)

---

## 获取帮助

- [GitHub Discussions](https://github.com/your-org/shadow-agents-platform/discussions)
- [开发者社区](#)

---
````

---

### 步骤 4：API 文档

**`docs/api-reference/authentication.md`**
````markdown
# 认证接口文档

Shadow Agents Platform 使用 JWT (JSON Web Token) 进行身份认证。

---

## 认证流程

1. 用户登录获取 Token
2. 在后续请求中携带 Token
3. Token 过期后使用 Refresh Token 刷新

---

## 接口列表

### 用户注册

**请求**

```http
POST /api/console/auth/register
Content-Type: application/json

{
  "email": "user@example.com",
  "name": "用户名",
  "password": "password123"
}
```

**响应**

```json
{
  "success": true,
  "message": "注册成功",
  "data": {
    "id": "uuid",
    "email": "user@example.com",
    "name": "用户名",
    "created_at": "2025-01-01T00:00:00Z"
  }
}
```

---

### 用户登录

**请求**

```http
POST /api/console/auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123"
}
```

**响应**

```json
{
  "success": true,
  "message": "登录成功",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_in": 3600
  }
}
```

---

### 刷新 Token

**请求**

```http
POST /api/console/auth/refresh
Content-Type: application/json
Authorization: Bearer {refresh_token}
```

**响应**

```json
{
  "success": true,
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_in": 3600
  }
}
```

---

### 获取当前用户信息

**请求**

```http
GET /api/console/auth/me
Authorization: Bearer {access_token}
```

**响应**

```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "email": "user@example.com",
    "name": "用户名",
    "role": "user",
    "avatar": "https://...",
    "created_at": "2025-01-01T00:00:00Z"
  }
}
```

---

## 使用 Token

在所有需要认证的接口中，在请求头中携带 Access Token：

```http
Authorization: Bearer {access_token}
```

---

## 错误码

| 状态码 | 错误码 | 说明 |
|--------|--------|------|
| 400 | VALIDATION_ERROR | 请求参数错误 |
| 401 | AUTHENTICATION_ERROR | 认证失败 |
| 401 | TOKEN_EXPIRED | Token 已过期 |
| 403 | PERMISSION_ERROR | 权限不足 |

---

## 示例代码

### JavaScript/TypeScript

```typescript
// 登录
const response = await fetch('http://localhost:5001/api/console/auth/login', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    email: 'user@example.com',
    password: 'password123',
  }),
})

const { data } = await response.json()
const accessToken = data.access_token

// 使用 Token 请求其他接口
const appsResponse = await fetch('http://localhost:5001/api/console/apps', {
  headers: {
    'Authorization': `Bearer ${accessToken}`,
  },
})
```

### Python

```python
import requests

# 登录
response = requests.post(
    'http://localhost:5001/api/console/auth/login',
    json={
        'email': 'user@example.com',
        'password': 'password123',
    }
)

data = response.json()['data']
access_token = data['access_token']

# 使用 Token 请求其他接口
apps_response = requests.get(
    'http://localhost:5001/api/console/apps',
    headers={'Authorization': f'Bearer {access_token}'}
)
```

---
````

---

## 文档检查清单

完成文档编写后，检查：

- [ ] 所有文档使用中文
- [ ] 代码示例可运行
- [ ] 链接有效
- [ ] 排版整洁
- [ ] 术语一致
- [ ] 覆盖所有核心功能
- [ ] 提供故障排查指南
- [ ] 包含最佳实践
- [ ] 有清晰的导航结构
- [ ] 定期更新维护

---

## 预计时间

- 快速开始指南：1 天
- 开发指南：2 天
- API 文档：2 天
- 架构文档：2 天
- 贡献指南：1 天
- 审核和完善：1 天
- **总计**：约 1.5 周

---

## 项目完成标志

完成本阶段后，整个项目的七个阶段全部完成：

✅ 阶段一：架构分析  
✅ 阶段二：基础结构  
✅ 阶段三：后端复刻  
✅ 阶段四：前端复刻  
✅ 阶段五：部署优化  
✅ 阶段六：品牌清理  
✅ 阶段七：文档编写  

**恭喜！Shadow Agents Platform 项目完成！🎉**

---
